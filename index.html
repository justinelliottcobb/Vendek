<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendek - Far Side Explorer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #000; }
        #canvas-container {
            width: 100%;
            height: 100%;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
        }
        #controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(20, 20, 30, 0.9);
            border: 1px solid rgba(100, 100, 150, 0.5);
            border-radius: 8px;
            padding: 15px;
            color: #ddd;
            font-family: system-ui, -apple-system, sans-serif;
            font-size: 13px;
            min-width: 250px;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        #controls.collapsed {
            min-width: auto;
            padding: 10px;
        }
        #controls.collapsed .controls-body {
            display: none;
        }
        #controls h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #88f;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        #controls h3:hover {
            color: #aaf;
        }
        .control-group {
            margin-bottom: 12px;
        }
        .control-group label {
            display: block;
            margin-bottom: 4px;
            color: #aaa;
        }
        .control-group input[type="range"] {
            width: 100%;
            accent-color: #66f;
        }
        .control-value {
            float: right;
            color: #8af;
            font-family: monospace;
        }
        #controls-toggle {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="controls">
        <h3 onclick="toggleControls()">
            <span>Vendek Controls</span>
            <span id="controls-toggle">−</span>
        </h3>
        <div class="controls-body">
            <div class="control-group">
                <label>Color Palette</label>
                <select id="palette" style="width: 100%; padding: 4px; background: #222; color: #ddd; border: 1px solid #444; border-radius: 4px;">
                    <option value="0">Rainbow</option>
                    <option value="1">Ocean</option>
                    <option value="2">Fire</option>
                    <option value="3">Forest</option>
                    <option value="4">Neon</option>
                    <option value="5">Pastel</option>
                    <option value="6">Monochrome</option>
                </select>
            </div>
            <div class="control-group">
                <label>Membrane Thickness <span class="control-value" id="val-thickness">0.4</span></label>
                <input type="range" id="membrane-thickness" min="0.1" max="2.0" step="0.05" value="0.4">
            </div>
            <div class="control-group">
                <label>Membrane Glow <span class="control-value" id="val-glow">0.5</span></label>
                <input type="range" id="membrane-glow" min="0" max="2.0" step="0.05" value="0.5">
            </div>
            <div class="control-group">
                <label>Step Size <span class="control-value" id="val-step">0.15</span></label>
                <input type="range" id="step-size" min="0.05" max="0.5" step="0.01" value="0.15">
            </div>
            <div class="control-group">
                <label>Density <span class="control-value" id="val-density">1.0</span></label>
                <input type="range" id="density" min="0.1" max="3.0" step="0.1" value="1.0">
            </div>
            <hr style="border-color: #444; margin: 15px 0;">
            <div style="color: #888; font-size: 11px; margin-bottom: 8px;">Performance</div>
            <div class="control-group">
                <label>Max Steps <span class="control-value" id="val-steps">128</span></label>
                <input type="range" id="max-steps" min="16" max="256" step="8" value="128">
            </div>
            <div class="control-group">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="enable-coupling" checked>
                    Membrane Coupling
                </label>
            </div>
        </div>
    </div>
    <script>
        function toggleControls() {
            const controls = document.getElementById('controls');
            const toggle = document.getElementById('controls-toggle');
            controls.classList.toggle('collapsed');
            toggle.textContent = controls.classList.contains('collapsed') ? '+' : '−';
        }

        // Store parameter values for WASM to read
        window.vendekParams = {
            membraneThickness: 0.4,
            membraneGlow: 0.5,
            stepSize: 0.15,
            density: 1.0,
            bloomIntensity: 0.4,
            maxSteps: 128,
            resolutionScale: 1.0,
            enableCoupling: 1.0,
            palette: 0
        };

        function setupSliders() {
            const sliders = [
                { id: 'membrane-thickness', param: 'membraneThickness', valId: 'val-thickness', decimals: 2 },
                { id: 'membrane-glow', param: 'membraneGlow', valId: 'val-glow', decimals: 2 },
                { id: 'step-size', param: 'stepSize', valId: 'val-step', decimals: 2 },
                { id: 'density', param: 'density', valId: 'val-density', decimals: 1 },
                { id: 'max-steps', param: 'maxSteps', valId: 'val-steps', decimals: 0 }
            ];

            sliders.forEach(s => {
                const slider = document.getElementById(s.id);
                const valDisplay = document.getElementById(s.valId);
                slider.addEventListener('input', () => {
                    const val = parseFloat(slider.value);
                    window.vendekParams[s.param] = val;
                    valDisplay.textContent = s.decimals === 0 ? val.toString() : val.toFixed(s.decimals);
                });
            });

            // Checkbox for coupling
            const couplingCheckbox = document.getElementById('enable-coupling');
            couplingCheckbox.addEventListener('change', () => {
                window.vendekParams.enableCoupling = couplingCheckbox.checked ? 1.0 : 0.0;
            });

            // Palette selector
            const paletteSelect = document.getElementById('palette');
            paletteSelect.addEventListener('change', () => {
                window.vendekParams.palette = parseInt(paletteSelect.value);
            });
        }

        setupSliders();
    </script>
    <script type="module" src="./web/bootstrap.js"></script>
</body>
</html>
